# MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«å¯¾å¿œä¿®æ­£

## å•é¡Œ

Kiroã‹ã‚‰`estat-aws`ã«æ¥ç¶šã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼š

```
[error] [estat-aws] Error connecting to MCP server: MCP error -32001: Request timed out
```

## åŸå› 

curlã‚³ãƒãƒ³ãƒ‰ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹è¨­å®šã§ã¯ã€MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®åˆæœŸåŒ–ãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ãŒã§ããªã„ã€‚
Kiroã¯MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆJSON-RPC 2.0ãƒ™ãƒ¼ã‚¹ï¼‰ã‚’ä½¿ç”¨ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã™ã‚‹ãŸã‚ã€
HTTP APIã‚’ç›´æ¥å‘¼ã³å‡ºã™ã“ã¨ã¯ã§ããªã„ã€‚

## è§£æ±ºæ–¹æ³•

MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã¨AWS Lambda APIã®é–“ã®ãƒ–ãƒªãƒƒã‚¸ã¨ãªã‚‹ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã€‚

### ä½œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

**mcp_aws_wrapper.py**
- MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ä¿¡
- AWS Lambda APIã«å¤‰æ›ã—ã¦é€ä¿¡
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«å½¢å¼ã«å¤‰æ›ã—ã¦è¿”ã™

### å¯¾å¿œã—ãŸMCPãƒ¡ã‚½ãƒƒãƒ‰

1. **initialize** - ã‚µãƒ¼ãƒãƒ¼åˆæœŸåŒ–
2. **tools/list** - ãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—
3. **tools/call** - ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ

## æ›´æ–°ã•ã‚ŒãŸè¨­å®š

### ~/.kiro/settings/mcp.json

```json
{
  "mcpServers": {
    "estat-aws": {
      "command": "python3",
      "args": [
        "/Users/yamashitayukihiro/Desktop/estat_enhanced_mcp_package_20260105_213238/mcp_aws_wrapper.py"
      ],
      "disabled": false
    }
  }
}
```

### å¤‰æ›´ç‚¹

**å¤‰æ›´å‰ï¼ˆå‹•ä½œã—ãªã„ï¼‰:**
```json
{
  "command": "curl",
  "args": ["-X", "POST", "https://...", "-H", "...", "-d", "@-"]
}
```

**å¤‰æ›´å¾Œï¼ˆå‹•ä½œã™ã‚‹ï¼‰:**
```json
{
  "command": "python3",
  "args": ["/path/to/mcp_aws_wrapper.py"]
}
```

## ãƒ†ã‚¹ãƒˆçµæœ

### 1. åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "2024-11-05",
    "capabilities": {},
    "clientInfo": {"name": "test", "version": "1.0.0"}
  }
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "protocolVersion": "2024-11-05",
    "capabilities": {"tools": {}},
    "serverInfo": {"name": "estat-aws", "version": "1.0.0"}
  }
}
```

âœ… **æˆåŠŸ**

### 2. ãƒ„ãƒ¼ãƒ«ä¸€è¦§ãƒ†ã‚¹ãƒˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/list",
  "params": {}
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
```json
{
  "jsonrpc": "2.0",
  "id": 2,
  "result": {
    "tools": [
      {
        "name": "search_estat_data",
        "description": "e-Statãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ¤œç´¢",
        "inputSchema": {
          "type": "object",
          "properties": {
            "query": {"type": "string"},
            "max_results": {"type": "integer"}
          }
        }
      },
      {
        "name": "fetch_dataset_auto",
        "description": "ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆè‡ªå‹•å–å¾—",
        "inputSchema": {
          "type": "object",
          "properties": {
            "query": {"type": "string"},
            "max_results": {"type": "integer"}
          }
        }
      }
    ]
  }
}
```

âœ… **æˆåŠŸ**

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Kiro                                 â”‚
â”‚                    (MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ MCP Protocol (JSON-RPC 2.0)
                              â”‚ stdin/stdout
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   mcp_aws_wrapper.py                         â”‚
â”‚                  (MCPãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒ–ãƒªãƒƒã‚¸)                       â”‚
â”‚                                                              â”‚
â”‚  - initialize â†’ ã‚µãƒ¼ãƒãƒ¼æƒ…å ±ã‚’è¿”ã™                            â”‚
â”‚  - tools/list â†’ AWS Lambda APIã‚’å‘¼ã³å‡ºã—                     â”‚
â”‚  - tools/call â†’ AWS Lambda APIã‚’å‘¼ã³å‡ºã—                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ HTTPS
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AWS Lambda + API Gateway                        â”‚
â”‚         https://pc6a551m8k.execute-api...                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ãƒ©ãƒƒãƒ‘ãƒ¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
2. âœ… Kiroè¨­å®šã‚’æ›´æ–°
3. âœ… åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
4. âœ… ãƒ„ãƒ¼ãƒ«ä¸€è¦§ãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
5. ğŸ”„ Kiroã‚’å†èµ·å‹•
6. ğŸ§ª Kiroã‹ã‚‰å®Ÿéš›ã«ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆ

## ä½¿ç”¨æ–¹æ³•

Kiroã‚’å†èµ·å‹•å¾Œã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’è©¦ã—ã¦ãã ã•ã„ï¼š

- ã€Œä¸–ç”°è°·åŒºã®äººå£ãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„ã€
- ã€Œæ±äº¬éƒ½ã®çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Module not found: requests"

**è§£æ±ºæ–¹æ³•:**
```bash
pip3 install requests
```

### ã‚¨ãƒ©ãƒ¼: "Permission denied"

**è§£æ±ºæ–¹æ³•:**
```bash
chmod +x mcp_aws_wrapper.py
```

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼

**åŸå› :** AWS Lambda APIã¸ã®æ¥ç¶šã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹

**è§£æ±ºæ–¹æ³•:**
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèª
- Lambdaé–¢æ•°ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèª
- CloudWatch Logsã§ã‚¨ãƒ©ãƒ¼ã‚’ç¢ºèª

## å‚è€ƒ

- [MCP Protocol Specification](https://modelcontextprotocol.io/)
- [JSON-RPC 2.0 Specification](https://www.jsonrpc.org/specification)

---

**ä¿®æ­£å®Œäº†æ—¥æ™‚**: 2026-01-08 16:10 JST  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å‹•ä½œç¢ºèªæ¸ˆã¿
