[0;34m==========================================
ECSサービス更新
==========================================[0m

イメージ: 639135896267.dkr.ecr.ap-northeast-1.amazonaws.com/estat-mcp-server:optimized-amd64-20260114_112828

[1;33mStep 1: 現在のタスク定義を取得...[0m
[0;32m✓ 現在のタスク定義: arn:aws:ecs:ap-northeast-1:639135896267:task-definition/estat-mcp-task:21[0m

[1;33mStep 2: タスク定義の詳細を取得...[0m
[0;32m✓ タスク定義を取得[0m

[1;33mStep 3: 新しいタスク定義を作成...[0m
[0;32m✓ 新しいタスク定義: arn:aws:ecs:ap-northeast-1:639135896267:task-definition/estat-mcp-task:22[0m

[1;33mStep 4: ECSサービスを更新...[0m
[0;32m✓ サービス更新を開始[0m

[1;33mStep 5: デプロイの進行状況を監視...[0m

  [0;34m[11:31:10] 進行状況: 0/0 タスクが実行中 (デプロイメント数: 3)[0m
  [0;34m[11:31:26] 進行状況: 0/0 タスクが実行中 (デプロイメント数: 3)[0m
  [0;34m[11:31:41] 進行状況: 0/1 タスクが実行中 (デプロイメント数: 3)[0m
  [0;34m[11:31:57] 進行状況: 0/1 タスクが実行中 (デプロイメント数: 3)[0m
  [0;34m[11:32:13] 進行状況: 0/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:32:28] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:32:44] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:32:59] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:33:15] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:33:30] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:33:46] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:34:02] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 2)[0m
  [0;34m[11:34:17] 進行状況: 1/1 タスクが実行中 (デプロイメント数: 1)[0m
[0;32m✓ デプロイ完了！[0m

[1;33mStep 6: 動作確認...[0m
  API URL: http://estat-mcp-alb-633149734.ap-northeast-1.elb.amazonaws.com

  ヘルスチェック実行中...
  結果: {"status": "healthy", "timestamp": "2026-01-14T02:34:28.394137"}
[0;32m✓ サービスは正常に動作しています[0m

[1;33mStep 7: クリーンアップ...[0m
[0;32m✓ 一時ファイルを削除[0m

[0;34m==========================================
更新完了サマリー
==========================================[0m

[0;32m✓ 新しいイメージ:[0m 639135896267.dkr.ecr.ap-northeast-1.amazonaws.com/estat-mcp-server:optimized-amd64-20260114_112828
[0;32m✓ タスク定義:[0m arn:aws:ecs:ap-northeast-1:639135896267:task-definition/estat-mcp-task:22
[0;32m✓ サービス:[0m estat-mcp-service

[1;33mAPI エンドポイント:[0m
  http://estat-mcp-alb-633149734.ap-northeast-1.elb.amazonaws.com

[1;33m修正内容:[0m
  ✓ load_to_iceberg: Athenaワークグループ問題を修正
  ✓ analyze_with_athena: 出力バケット設定を改善
  ✓ イメージサイズ: 1GB → 736MB（約270MB削減）

[1;33mログの確認:[0m
  aws logs tail /ecs/estat-mcp --follow --region ap-northeast-1

[1;33mロールバック方法:[0m
  以前のタスク定義に戻す場合:
  aws ecs update-service --cluster estat-mcp-cluster --service estat-mcp-service --task-definition arn:aws:ecs:ap-northeast-1:639135896267:task-definition/estat-mcp-task:21 --region ap-northeast-1

[0;32m==========================================
ECS更新が完了しました！
==========================================[0m
